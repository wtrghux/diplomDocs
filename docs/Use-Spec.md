# Спецификация прецедента

## Предусловия

Пользователь (пациент или врач) выполнил вход в аккаунт;

Пациент записал звук фистулы.

## Постусловия

Звуковые файлы с шумами фистулы сохранены;

Результаты обработки загруженных файлов сохранены;

Характеристики фистулы показаны пациенту;

Список пациентов врача получен и показан пользователю.

## Загрузка и обработка звукового файла с шумами фистулы

### Текстовое описание

- Пациент открывает сайт;
- Сайт загружает стартовую страницу;
- Пользователь авторизуется на сайте;
- Сайт отпраляет логин и пароль на сервер;
- Сервер обращается к базе данных;
- В базе данных выполняется запрос и результат возвращается на сервер;
- Сервер проверяет соответствие логина и пароля;
- При успешной авторизации загружается личный кабинет;
- Пациент выбирает функцию загрузки звуковых файлов;
- Пациент выбирает звуковые файлы на устройстве и прикрепляет их во вложении;
- Файлы загружаются на сервер и проверяются на соответствие формату wav;
- Сервер сохраняет звуковые файлы в базу данных;
- Сервер обрабатывает звуковые файлы и записывает характеристики фистулы пациента;
- Файл с результатами сохраняется в БД;
- Результат обработки отображается у пациента;

### Диаграмма последовательностей

```mermaid
sequenceDiagram
    participant pat as Пациент
    participant web as Веб-сайт
    participant serv as Сервер
    participant db as База данных
    pat ->> web: Открывает сайт
    web ->> pat: Отображение главной страницы
    pat ->> web: Входит в аккаунт
    web ->> serv: Передаёт логин и пароль
    serv ->> db: Отправляет запрос на логин/пароль
    db ->> serv: Возвращает результат
    serv ->> serv: Проверяет логин и пароль
    serv ->> web: Перенаправляет в личный кабинет
    pat ->> web: Выбирает функцию "Загрузить файл"
    pat ->> web: Прикрепляет файл и отправляет
    web ->> serv: Проверяет соответствие формата файла
    serv ->> db: Сохраняет звуковой файл в базу данных
    serv ->> web: Обрабатывает загруженный файл с помощью алгоритмов
    serv ->> db: Сохраняет файл с результатами обработки в базу данных
    web ->> pat: Отображает характеристики фистулы пользователю
```

![sequence #1](../pics/Use-spec-1.jpg)

---

## Получение списка пациентов одного врача

### Текстовое описание

- Врач открывает сайт;
- Сайт загружает стартовую страницу;
- Пользователь авторизуется на сайте;
- Сайт отпраляет логин и пароль на сервер;
- Сервер обращается к базе данных;
- В базе данных выполняется запрос и результат возвращается на сервер;
- Сервер проверяет соответствие логина и пароля;
- При успешной авторизации загружается личный кабинет;
- Врач переходит на вкладку "Пациенты";
- Сервер обращается к базе данных;
- В ответ возвращается список всех пациентов авторизованного врача;
- Врач вводит номер истории болезни;
- Сервер обращается к базе данных и передает введенный параметр;
- База данных выполняет SQL запрос и возвращает результат;
- Полученный список пациентов либо информация по конкретному пациенту отображается врачу;

### Диаграмма последовательностей

```mermaid
sequenceDiagram
    participant doc as Врач
    participant web as Веб-сайт
    participant serv as Сервер
    participant db as База данных
    doc ->> web: Открывает сайт
    web ->> doc: Отображение главной страницы
    doc ->> web: Входит в аккаунт
    web ->> serv: Передаёт логин и пароль
    serv ->> db: Отправляет запрос на логин/пароль
    db ->> serv: Возвращает результат
    serv ->> serv: Проверяет логин и пароль
    serv ->> web: Перенаправляет в личный кабинет
    alt список пациентов
        doc ->> web: Выбирает функцию "Пациенты"
        serv ->> db: Выполняет запрос
        db ->> serv: Возвращает список пациентов
    else конкретный пациент
        doc ->> web: Выбирает функцию "Пациенты"<br>И вводит номер истории болезни пациента
        serv ->> db: Выполняет запрос
        db ->> serv: Возвращает найденного пациента
    end
    serv ->> web: Передает полученные данные
    web ->> doc: Предоставляет полученные данные врачу
```

![sequence #2](../pics/Use-spec-2.jpg)
